# 18. 数据库索引技术
重点与难点

- 理解索引的作用，掌握应用索引改进数据库查询性能的方法
- 理解不同类型索引的概念：稠密索引与稀疏索引，主索引与辅助索引，聚簇索引与非聚簇索引，倒排索引，多级索引等
- 理解B+树索引，怎样建立、维护和利用B+树索引(算法层面)
- 理解散列索引，包括静态散列索引与动态散列索引(算法层面)

## 18.1 为什么需要索引与什么是索引
- 索引项：索引字段、行指针
- 索引文件组织方式：排序索引文件、散列索引文件
- 索引应用的评价：
- 索引相关概念：排序码、索引码、搜索码、主文件、索引文件

## 18.2 索引的简单分类
- **稠密索引与稀疏索引**
	- 稠密索引通常是按索引字段值进行排序的一个有序文件

- **主索引与辅助索引**
	- 主索引通常是对每一存储块有一个索引项，是按索引字段值进行排序的一个有序文件，通常建立在有序主文件的基于主码的排序字段上
	- 主索引是稀疏索引
	- 辅助索引通常是对某一非排序字段上的每一个不同值有一个索引项，辅助索引是稠密索引，其检索效率有时相当高
	- 可以利用主索引重新组织主文件数据，但辅助索引不能改变主文件数据
- 聚簇索引与非聚簇索引
	- 聚簇索引：索引中邻近的记录在主文件中也是临近存储的
	- 非聚簇索引：索引中邻近的记录在主文件中不一定是邻近存储的
	- 一个主文件只能有一个聚簇索引文件，但可以有多个非聚簇索引文件
	- 主索引通常是聚簇索引；辅助索引通常是非聚簇索引
	- 主索引/聚簇索引是能够决定记录存储位置的索引；而非聚簇索引则只能用于查询，指出已存储记录的位置
	- 聚簇索引通常是对聚簇字段上的每一个不同值有一个索引项

## 18.3 B+树索引
- B+树：一块中有n个指针，n-1个索引项；B树：2n个指针，n-1索引项
- 叶结点某索引项X的左侧指针，指向键值=X记录所在的**主文件存储块**
- 非叶结点某索引项X的左侧指针指向键值<X记录所在的**索引文件存储块**
- 用B+树建立稠密索引时，主文件可以按该属性排序存储，也可以不按该属性排序存储
- 用B+树建立稀疏索引时，主文件必须按该属性排序存储

## 18.4 散列索引
- 散列索引：索引采用散列技术确定索引项的存储块
- 可扩展散列索引：引入一间接层，即用一个指向块的指针数组来表示桶。散列函数h为每个键计算出一个K位二进制序列，桶的数目总是使用从序列第一位或最后一位算起的若干位。
- 线性散列索引：解决桶的数目过快增长，但其利用率不足的问题。桶数n的选择总是使存储块的平均记录数保持与存储块所能容纳的记录总数成一个固定的比例，例如80%。超过此比例，则桶数增长1块，分裂。

## 18.5 习题
- 一个主文件上只能有一个可决定物理存储的索引
- 索引文件存在与否不改变主文件的物理存储，所以索引可以随时被删除并重建
- 当主文件数量较少时，用索引进行查询可能要多花一些时间。因为需检索为索引，再检索主文件。
- 执行一条查询语句，当有索引时，DBMS总是首先在索引中查找，然后根据索引中的指针到主文件中查找。**错**。**DBMS会依据检索条件确定是否使用索引**
- 主索引由DBMS自动建立，其它索引可由用户或DBA依据需要建立，所有索引DBMS自动维护
- 稠密索引，对于Table中的每一个记录，总是有一个索引项。**错**。稠密索引是对于Table中索引字段的每一个不同值，总是有一个索引项
- 聚簇索引中一定不存在重复键值的索引项。**错**
- B+树如果发生合并，**不一定会减少**索引存储块的数目
- B+树在任何情况下都可以保证结点中指针的使用率大于等于50%。**错**。根节点不一定。
- 主索引通常确定“表”数据的**物理顺序**