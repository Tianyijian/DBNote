# 19. 数据库查询实现算法之一趟扫描算法
重点与难点

- 理解数据库查询实现的基本思想--逻辑算法和物理算法
- 理解查询实现算法与内外存环境的关系--如何利用内存
- 从物理存储上理解关系运算：一趟扫描算法
- 掌握关系运算的几个一趟扫描算法及其应用条件与算法复杂性

## 19.1 数据库查询实现算法概述
- 数据库三大类操作
	- 一次单一元组的一元操作：投影、选择
	- 整个关系的一元操作：去重、分组、排序
	- 整个关系的二元操作：集合上的操作（并、交、差），包上的操作（并、交、差），积，连接

## 19.2 以连接操作为例看逻辑实现算法与物理实现算法
- 连接操作的逻辑实现算法：Brxs = TrTs(Ir+Is)/b
- 连接操作的基本实现算法：Br + Br x Bs
- **连接操作的全主存实现算法：（条件 M >= Br + Bs） Br + Bs**
- **连接操作的半主存实现算法：（条件 Bs >= Br，Br < M） Br + Bs**
- **连接操作的大关系实现算法：（条件 Bs >= M, Br >= M） Br(Bs / (M-2)) + Bs**

## 19.3 利用迭代器构造查询实现算法
- **选择、投影、并、交、差**

## 19.4 几个关系操作的一趟扫描算法
- **去重复**
	- 内存块数足以装得下关系中不重复元组数目，即可执行
	- 算法可以做到只与一个内存块中的数据进行比较，即可判断出是否有重复
	- 算法的关键是建立内存数据结构，可以建立散列结构，也可以建立排序结构，目的是进行快速比较。
- **分组聚集**
	- 内存块数足以装得下关系中所有分组及每个分组上的不同值，即可执行
	- 有些分组计算是在建立起完整的数据结构后才能进行

## 19.5 基于索引的查询实现算法
- **基于索引的选择算法**

	假设B(R)=1000, T(R)=20 000, 即：R有20000个元组存放到1000个块
	中。a是R的一个属性，在a上有一个索引，并且考虑选择a=0(R)操作：
	
	- 如果R是聚簇的，且不使用索引，查询代价＝1000个I/O；
	- 如果R不是聚簇的，且不使用索引，查询代价＝20000个I/O； 。
	- 如果V(R,a)=100且索引是聚簇的，查询代价=1000/100=10个I/O。V(R, a)表示a属性在R中出现的不同值的个数
	- 如果V(R,a)=100且索引是非聚簇的，查询代价=20000/100 =200个I/O。
	- 如果V(R,a)=20000，即a是关键字，查询代价=20000/20000 =1个I/O。不管是否是聚簇的。

- 基于索引的连接算法：Zig-Zag连接算法

## 19.6 习题
- **选择操作和包上的并操作**，任何时候都可以一趟算法实现
- **表空间扫描算法的复杂性**可能为B(R)，也可能为T(R)；